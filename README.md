# async-data-pipeline

## Vision
Demonstrate a lightweight, event-driven pipeline for ecommerce order processing using Kafka, FastAPI, and modern async Python.

## Scenario & Data Source
Synthetic order events are generated by tools and published to Kafka. Real data sources can be integrated later.

## Avro schema
Defined in `app/producer/schemas/order_event.avsc` and partitioned by **`order_id`**.

## Functional Requirements
- POST `/events` publishes to Kafka within 100 ms.
- Consumers enrich, deduplicate, and run fraud checks before writing to Postgres.
- Exactly-once in prod with idempotent writes; at-least-once in dev.

## Architecture diagram
```
FastAPI Producer -> Kafka `orders.raw` -> Async Consumer -> Postgres/Redis -> Read API
```

## AWS Mapping & Costs
Infrastructure maps to MSK, ECS Fargate, RDS, ElastiCache, S3, CloudWatch, and Budgets. Target monthly cost ≈ $12–15.

## Tech Stack
Python 3.12, FastAPI, aiokafka, Redis, Postgres, Terraform, GitHub Actions, dbt.

## Local Workflow
`make dev-bootstrap` then `make compose-up` to start local stack; `make test` for tests.

## Consistency & Logging
Eventual consistency: read side may lag. Structured JSON logs carry `trace_id`, `span_id`, and `order_id` for each event.

## Observability
Both the FastAPI producer and async consumer load `configs/logging.yaml` for structured logs and `configs/otel.yaml` to configure OpenTelemetry exporters. FastAPI routes and Kafka loops emit spans, and metrics are exposed via `prometheus_client` at `/metrics`.

To check metrics locally:

```bash
uvicorn app.producer.main:app --port 8000 &
curl -s http://localhost:8000/metrics | head
```

Stop the server after inspection.

## dbt Nightly
A scheduled GitHub Action runs dbt models and publishes docs at 05:00 UTC.

## Repo Structure
See directories like `app/`, `tools/`, `configs/`, `infra/terraform/`, and `ci/github/workflows/` for implementation details.

## Milestones
- Initial skeleton pipeline
- Add monitoring and analytics
- Harden for production

## Immediate Next Steps
Fill TODOs for cloud resources and expand test coverage.
